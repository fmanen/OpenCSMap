{% extends "base.html" %}
{% load static %}
{% block advanced_search_item %}
    <li class="nav-item active">
{% endblock %}
{% block content %}
<head>
	<title>OpenCSMap</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
</head>
<body>
    <br>
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-4">
                <h1>Advanced Search</h1>
            </div>
        </div>
        <form action="/search/advanced_search_results" method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                    <b>Research topic:</b>
                </div>
                <div class="col-md-4">
                    <b>Publication range:</b>
                </div>
            </div>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                    <br>
                    <input required type="text" class="form-control"
                                        name="topic" id="topic">
                </div>
                <div class="col-md-2">
                    <b>From:</b> <select class="form-control" id="from-date" name="from-date">
                        <option value=0>---</option>
                        {% for i in years %}
                        <option value={{i}}>{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <b>To:</b> <select class="form-control" id="to-date" name="to-date">
                        <option value=0>---</option>
                        {% for i in years %}
                        <option value={{i}}>{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                    <b>Author(s):</b>
                </div>
                <div class="col-md-2">
                    <b>Aggregate results by:</b>
                </div>
                <div class="col-md-2">
                    <b>Type of publication:</b>
                </div>
            </div>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                    <input type="text" class="form-control"
                    name="authors" id="authors" >
                </div>
                <div class="col-md-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="results-by" id="affiliation" value="affiliation"
                        checked="checked">
                        <label class="form-check-label" for="inlineRadio0">Affiliation</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="results-by" id="city" value="city">
                        <label class="form-check-label" for="inlineRadio0">City</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="results-by" id="country" value="country">
                        <label class="form-check-label" for="inlineRadio0">Country</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="type-of-pub" id="all" value="all"
                        checked="checked">
                        <label class="form-check-label" for="inlineRadio1">All</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="type-of-pub" id="inproceedings" value="inproceedings">
                        <label class="form-check-label" for="inlineRadio1">Inproceedings</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="type-of-pub" id="article" value="article">
                        <label class="form-check-label" for="inlineRadio1">Journal</label>
                    </div>
                    <br>
                    <br>
                    <button onclick="" type="submit" class="btn btn-block btn-lg btn-primary">Search</button>
                </div>
            </div>
        </form>
    
        <script>

            function resetErrors() {
                document.getElementById("error-fecha-inicio").innerHTML = '';
                document.getElementById("error-fecha-fin").innerHTML = '';
                document.getElementById("error-hora-inicio").innerHTML = '';
                document.getElementById("error-hora-fin").innerHTML = '';
                document.getElementById("submit-button").disabled = false;
            }
    
    
            var ini = 0;
            var fin = 0;
            var start = Date();
            var end = Date();
    
            var hini = 0;
            var hfin = 0;
            var hstart = Date();
            var hend = Date()
    
            $('#from-date').on('change', function(){
                start = $('#from-date').val()
                if(end < start) {
                    document.getElementById("error-fecha-inicio").innerHTML = 'Debe ser anterior a fecha de fin';
                    document.getElementById("submit-button").disabled = true;
                }
                else if(end.valueOf() == start.valueOf() && hend < hstart) {
                    document.getElementById("error-hora-fin").innerHTML = 'Debe ser posterior a hora de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else{
                   resetErrors();
                }
    
            });
    
            $('#to-date').on('change', function(){
                fin = $('#fecha-fin-actividad').val()
                end = new Date(fin);
                if(end < start) {
                    document.getElementById("error-fecha-fin").innerHTML = 'Debe ser posterior a fecha de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else if(end.valueOf() == start.valueOf() && hend < hstart) {
                    document.getElementById("error-hora-fin").innerHTML = 'Debe ser posterior a hora de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else{
                   resetErrors();
                }
            });
    
            $('#hora-inicio-actividad').on('change', function(){
                hini = $('#hora-inicio-actividad').val()
                hstart = Date.parse("01/01/2001 ".concat(hini))
                if(end.valueOf() == start.valueOf() && hend < hstart) {
                    document.getElementById("error-hora-inicio").innerHTML = 'Debe ser anterior a hora de fin';
                    document.getElementById("submit-button").disabled = true;
                }
                else if (end.valueOf() < start.valueOf()){
                    document.getElementById("error-fecha-fin").innerHTML = 'Debe ser posterior a fecha de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else{
                   resetErrors();
                }
            });
    
            $('#hora-fin-actividad').on('change', function(){
                hfin = $('#hora-fin-actividad').val()
                hend = Date.parse("01/01/2001 ".concat(hfin))
                if(end.valueOf() == start.valueOf() && hend < hstart) {
                    document.getElementById("error-hora-fin").innerHTML = 'Debe ser posterior a fecha de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else if (end.valueOf() < start.valueOf()){
                    document.getElementById("error-fecha-fin").innerHTML = 'Debe ser posterior a fecha de inicio';
                    document.getElementById("submit-button").disabled = true;
                }
                else{
                   resetErrors();
                }
            });
    
        </script>



</body>

{% endblock %}